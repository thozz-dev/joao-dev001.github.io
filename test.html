<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Access Portal - El Cartel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff00;
            overflow: hidden;
            height: 100vh;
        }

        .security-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.8s ease-out;
        }

        .security-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .terminal-window {
            width: 90vw;
            max-width: 800px;
            height: 45vh;
            max-height: 1000px;
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #00ff00;
            border-radius: 5px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.2);
        }

        .terminal-header {
            background: linear-gradient(90deg, #001100, #003300);
            padding: 1rem;
            border-bottom: 1px solid #00ff00;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terminal-buttons {
            display: flex;
            gap: 5px;
        }

        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 15px;
            background: #ff5f56;
        }

        .terminal-button:nth-child(2) { background: #ffbd2e; }
        .terminal-button:nth-child(3) { background: #27ca3f; }

        .terminal-title {
            color: #00ff00;
            font-size: 1rem;
            font-weight: bold;
        }

        .terminal-content {
            padding: 1rem;
            height: calc(100% - 60px);
            overflow-y: auto;
            position: relative;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .terminal-content::-webkit-scrollbar {
            display: none;
        }

        .terminal-line {
            margin: 0.4rem 0;
            opacity: 0;
            animation: typeIn 0.03s ease-in-out forwards;
        }

        .terminal-line.error {
            color: #ff3333;
        }

        .terminal-line.warning {
            color: #ffaa00;
        }

        .terminal-line.success {
            color: #00ff00;
        }

        .terminal-line.info {
            color: #0099ff;
        }

        .cursor {
            display: inline-block;
            background: #00ff00;
            width: 2px;
            height: 1em;
            animation: blink 0.8s infinite;
        }

        @keyframes typeIn {
            to { opacity: 1; }
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        .progress-bar {
            width: 100%;
            height: 18px;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #00aa00);
            width: 0%;
            transition: width 0.2s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .matrix-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.05;
        }

        .matrix-char {
            position: absolute;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            animation: matrixFall 2s linear infinite;
        }

        @keyframes matrixFall {
            0% {
                transform: translateY(-100vh);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        .glitch {
            position: relative;
            display: inline-block;
        }

        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .glitch::before {
            animation: glitch1 0.15s infinite; /* Glitch plus rapide */
            color: #ff0000;
            z-index: -1;
        }

        .glitch::after {
            animation: glitch2 0.15s infinite; /* Glitch plus rapide */
            color: #0000ff;
            z-index: -2;
        }

        @keyframes glitch1 {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-1px, 1px); } /* DÃ©calage rÃ©duit */
            40% { transform: translate(-1px, -1px); }
            60% { transform: translate(1px, 1px); }
            80% { transform: translate(1px, -1px); }
        }

        @keyframes glitch2 {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(1px, -1px); } /* DÃ©calage rÃ©duit */
            40% { transform: translate(1px, 1px); }
            60% { transform: translate(-1px, -1px); }
            80% { transform: translate(-1px, 1px); }
        }

        .scan-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ff00, transparent);
            animation: scan 1.5s linear infinite; /* Scan plus rapide */
        }

        @keyframes scan {
            0% { top: 0; opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        @media (max-width: 768px) {
            .terminal-window {
                width: 95vw;
                height: 60vh;
            }

            .terminal-title {
                font-size: 0.8rem;
            }

            .terminal-content {
                padding: 0.5rem;
                height: calc(100% - 50px);
            }

            .terminal-line {
                margin: 0.3rem 0;
                font-size: 0.9rem;
            }

            .progress-bar {
                height: 15px;
            }
        }

        .main-content {
            opacity: 0;
            transition: opacity 0.8s ease-in;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #0d1a0d 100%);
            min-height: 100vh;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .main-content.visible {
            opacity: 1;
        }

        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(34, 139, 34, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(220, 20, 60, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 60px 0 40px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(34, 139, 34, 0.3);
            border-radius: 10px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header .btn {
            display: inline-block;
            align-items: center;
            padding: 10px 20px;
            background: linear-gradient(135deg, #228B22, #32CD32);
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 900;
            font-size: 1.0rem;
            text-align: center;
            margin-top: 20px;
            max-width: 250px;
            max-height: 50px;;
            transition: background 0.3s ease;
        }

        .header .btn:hover {
            background: linear-gradient(135deg, #228B22, #ffffff, #dc143c);
        }

        .logo {
            width: 100px;
            height: 100px;
            margin: 0 auto 30px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #dc143c;
            box-shadow: 0 0 30px rgba(220, 20, 60, 0.3);
            transition: all 0.3s ease;
        }

        .logo:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(220, 20, 60, 0.5);
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .title {
            font-size: 2.8rem;
            font-weight: 300;
            background: linear-gradient(135deg, #228B22, #ffffff, #dc143c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        .subtitle {
            color: #888;
            font-size: 1.1rem;
            font-weight: 300;
            margin-bottom: 30px;
            letter-spacing: 1px;
        }

        .flag-divider {
            width: 200px;
            height: 4px;
            background: linear-gradient(to right, #228B22 33%, white 33%, white 66%, #dc143c 66%);
            margin: 0 auto;
            border-radius: 2px;
        }

        .page {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-container {
            max-width: 500px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            padding: 50px;
            border-radius: 10px;
            border: 1px solid rgba(34, 139, 34, 0.3);
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .auth-title {
            text-align: center;
            color: #ffffff;
            font-size: 1.8rem;
            font-weight: 300;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(34, 139, 34, 0.3);
        }

        .form-group {
            margin-bottom: 30px;
            position: relative;
        }

        .form-group label {
            display: block;
            color: #b0b0b0;
            margin-bottom: 10px;
            font-weight: 500;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(34, 139, 34, 0.4);
            border-radius: 5px;
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
            outline: none;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: #228B22;
            box-shadow: 0 0 20px rgba(34, 139, 34, 0.2);
            background: rgba(0, 0, 0, 0.8);
        }

        .form-group input::placeholder {
            color: #666;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #228B22, #32CD32);
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #32CD32, #228B22);
            box-shadow: 0 5px 20px rgba(34, 139, 34, 0.4);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc143c, #ff4757);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #ff4757, #dc143c);
            box-shadow: 0 5px 20px rgba(220, 20, 60, 0.4);
        }

        .shop-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 40px;
            border: 1px solid rgba(34, 139, 34, 0.3);
            backdrop-filter: blur(15px);
        }

        .shop-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .shop-title {
            font-size: 2.5rem;
            font-weight: 300;
            color: #ffffff;
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .product-card {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(34, 139, 34, 0.3);
            border-radius: 10px;
            padding: 30px;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(34, 139, 34, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .product-card:hover::before {
            left: 100%;
        }

        .product-card:hover {
            border-color: #228B22;
            box-shadow: 0 10px 40px rgba(34, 139, 34, 0.2);
            transform: translateY(-5px);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .product-title {
            color: #ffffff;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .product-category {
            color: #888;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .product-price {
            color: #dc143c;
            font-size: 1.8rem;
            font-weight: 700;
            white-space: nowrap;
        }

        .product-description {
            color: #b0b0b0;
            margin-bottom: 25px;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .product-actions .btn {
            flex: 1;
            margin: 0;
            padding: 12px;
            font-size: 0.9rem;
        }

        .cart-widget {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid rgba(220, 20, 60, 0.5);
            border-radius: 10px;
            padding: 20px;
            z-index: 1000;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .cart-header {
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cart-header:hover {
            transform: scale(1.05);
        }

        .cart-icon {
            color: #dc143c;
            font-size: 1.4rem;
            margin-right: 10px;
        }

        .cart-count {
            background: linear-gradient(135deg, #dc143c, #ff4757);
            color: white;
            border-radius: 20px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .cart-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 350px;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(220, 20, 60, 0.5);
            border-radius: 10px;
            padding: 25px;
            margin-top: 15px;
            display: none;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
        }

        .cart-dropdown.open {
            display: block;
            animation: slideDown 0.4s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .cart-item {
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-name {
            color: #ffffff;
            font-weight: 500;
        }

        .cart-item-price {
            color: #dc143c;
            font-weight: bold;
        }

        .cart-item-remove {
            background: none;
            border: none;
            color: #dc143c;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .cart-item-remove:hover {
            background: rgba(220, 20, 60, 0.2);
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid #228B22;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            z-index: 2000;
            display: none;
            backdrop-filter: blur(15px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            max-width: 500px;
        }

        .notification.show {
            display: block;
            animation: modalAppear 0.5s ease;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .notification h3 {
            color: #228B22;
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 300;
        }

        .notification p {
            color: #b0b0b0;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .error-message {
            background: rgba(220, 20, 60, 0.1);
            border: 1px solid rgba(220, 20, 60, 0.3);
            color: #ff6b7a;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        .error-message.show {
            display: block;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .loading {
            display: none;
            text-align: center;
            color: #228B22;
            margin-top: 20px;
        }

        .loading.show {
            display: block;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #228B22;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .modal {
            display: flex;
            position: fixed;
            z-index: 2001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            margin: auto;
            padding: 30px;
            border: 1px solid rgba(34, 139, 34, 0.5);
            border-radius: 10px;
            width: 80%;
            max-width: 700px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.7);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            position: relative;
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .modal-image {
            width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: contain;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid rgba(220, 20, 60, 0.3);
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .close-button:hover,
        .close-button:focus {
            color: #dc143c;
            text-decoration: none;
            transform: scale(1.1);
        }

        .modal-title {
            color: #ffffff;
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .modal-category {
            color: #888;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .modal-price {
            color: #dc143c;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .modal-description {
            color: #b0b0b0;
            line-height: 1.7;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-actions .btn {
            width: auto;
            padding: 12px 25px;
            font-size: 1rem;
        }

        /* NOUVEAUX STYLES POUR LA PAGE GANGS ET LE MODAL D'Ã‰DITION */
        .gangs-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 40px;
            border: 1px solid rgba(34, 139, 34, 0.3);
            backdrop-filter: blur(15px);
            margin-top: 40px;
        }

        .gangs-title {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 300;
            color: #ffffff;
            margin-bottom: 20px;
            letter-spacing: 2px;
        }

        #gangsContent h4 {
            color: #27ca3f;
            font-size: 1.5rem;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(34, 139, 34, 0.2);
            padding-bottom: 5px;
        }

        #gangsContent p {
            color: #b0b0b0;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        #gangsContent ul {
            list-style: none;
            padding-left: 20px;
        }

        #gangsContent ul li {
            color: #b0b0b0;
            margin-bottom: 5px;
        }

        #gangsContent ul li::before {
            content: "Â» ";
            color: #00ff00;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }

        .edit-textarea {
            width: 100%;
            height: 300px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid rgba(34, 139, 34, 0.4);
            border-radius: 5px;
            color: #ffffff;
            font-size: 1rem;
            padding: 15px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            margin-bottom: 20px;
        }
        /* FIN NOUVEAUX STYLES */

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .auth-container {
                padding: 30px 25px;
            }

            .shop-grid {
                grid-template-columns: 1fr;
            }

            .cart-widget {
                top: 20px;
                right: 20px;
                padding: 15px;
            }

            .cart-dropdown {
                width: 280px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .modal-title {
                font-size: 1.5rem;
            }

            .modal-price {
                font-size: 1.8rem;
            }

            .modal-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="security-overlay" id="securityOverlay">
        <div class="matrix-bg" id="matrixBg"></div>
        <div class="terminal-window">
            <div class="terminal-header">
                <div class="terminal-buttons">
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                </div>
                <div class="terminal-title">SECURE_ACCESS_TERMINAL v2.1.4</div>
            </div>
            <div class="terminal-content">
                <div class="scan-line"></div>
                <div id="terminalOutput"></div>
                <div class="progress-bar" style="display: none;" id="progressBar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="main-content" id="mainContent">
        <div class="background-overlay"></div>
        <div class="container">
            <div class="header">
                <div class="logo">
                    <img src="https://media.discordapp.net/attachments/1232583375181582366/1387087700313505852/3fcf2fe3-dd13-4798-9041-e8af8b338b51.png?ex=685c1196&is=685ac016&hm=0b98e6a808a15974a5bf2b1dd9d6467734bb0c31341970e093e34bee56b17fbb&=&format=webp&quality=lossless&width=930&height=930" alt="El Cartel Logo">
                </div>
                <h1 class="title">EL CARTEL</h1>
                <p class="subtitle">SECURE ACCESS PORTAL</p>
                <a href="index.html" class="btn" id="homeRedirect">ðŸ’§ EveryWater</a>
            </div>
            <div class="page active" id="authPage">
                <div class="auth-container">
                    <h2 class="auth-title">AUTHENTIFICATION REQUISE</h2>
                    <form id="authForm">
                        <div class="form-group">
                            <label for="name">ID</label>
                            <input type="text" id="name" name="name" placeholder="Entrez votre identifiant" required>
                        </div>
                        <div class="form-group">
                            <label for="message">Code d'accÃ¨s / Message</label>
                            <input type="text" id="message" name="message" placeholder="Entrez votre code d'accÃ¨s" required>
                        </div>
                        <button type="submit" class="btn">AUTHENTIFIER</button>
                        <div class="loading" id="loading">VÃ©rification en cours...</div>
                        <div class="error-message" id="errorMessage">AccÃ¨s refusÃ©. VÃ©rifiez vos identifiants.</div>
                    </form>
                </div>
            </div>
            <div class="page" id="shopPage">
                <div class="cart-widget">
                    <div class="cart-header" onclick="toggleCart()">
                        <span class="cart-icon">ðŸ›’</span>
                        <span class="cart-count" id="cartCount">0</span>
                    </div>
                    <div class="cart-dropdown" id="cartDropdown">
                        <h3 style="color: #dc143c; margin-bottom: 20px; font-size: 1.2rem;">PANIER ðŸ›’</h3>
                        <div id="cartItems"></div>
                        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <button class="btn btn-danger" onclick="checkout()">ACHETER ðŸª™</button>
                        </div>
                    </div>
                </div>
                <div class="shop-container">
                    <div class="shop-header">
                        <h2 class="shop-title">MARCHÃ‰ PRIVÃ‰</h2>
                        <div class="flag-divider"></div>
                    </div>
                    <div class="shop-grid" id="productGrid">
                    </div>
                </div>
            </div>
            <div class="page" id="gangsPage">
                <div class="gangs-container">
                    <h2 class="gangs-title">INFORMATIONS CLASSIFIÃ‰ES</h2>
                    <div class="flag-divider"></div>
                    <div id="gangsContent">
                        <p style="color: #b0b0b0; text-align: center;">Chargement des donnÃ©es...</p>
                    </div>
                    <button class="btn" id="editGangsBtn" style="display: none; margin-top: 30px;">MODIFIER LES DONNÃ‰ES</button>
                </div>
            </div>
        </div>
        <div id="productModal" class="modal">
            <div class="modal-content">
                <span class="close-button" onclick="closeModal()">&times;</span>
                <img id="modalImage" src="" alt="Product Image" class="modal-image">
                <h3 id="modalTitle" class="modal-title"></h3>
                <p id="modalCategory" class="modal-category"></p>
                <p id="modalPrice" class="modal-price"></p>
                <p id="modalDescription" class="modal-description"></p>
                <div class="modal-actions">
                    <button class="btn" id="modalAddToCartBtn">PANIER ðŸ›’</button>
                    <button class="btn btn-danger" id="modalBuyDirectBtn">ACHETER ðŸª™</button>
                </div>
            </div>
        </div>
        <div id="editModal" class="modal">
            <div class="modal-content">
                <span class="close-button" onclick="closeEditModal()">&times;</span>
                <h3 class="modal-title">Ã‰DITER LES DONNÃ‰ES DES GANGS</h3>
                <textarea id="editGangsData" class="edit-textarea"></textarea>
                <button class="btn" onclick="saveGangsData()">ENREGISTRER</button>
                <div class="error-message" id="editErrorMessage"></div>
            </div>
        </div>
        <div class="notification" id="notification">
            <h3>COMMANDE ENREGISTRÃ‰E</h3>
            <p>Votre demande a Ã©tÃ© transmise avec succÃ¨s.</p>
            <p>Un membre de notre Ã©quipe vous contactera dans les plus brefs dÃ©lais via des canaux sÃ©curisÃ©s.</p>
            <p style="font-size: 0.9rem; color: #666;">RÃ©fÃ©rence: <span id="orderRef"></span></p>
            <button class="btn" onclick="closeNotification()">FERMER</button>
        </div>
    </div>
    <script>
        class SecurityAnimation {
            constructor() {
                this.terminalOutput = document.getElementById('terminalOutput');
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                this.securityOverlay = document.getElementById('securityOverlay');
                this.mainContent = document.getElementById('mainContent');

                this.commands = [
                    { text: ">>> Initialisation du module de sÃ©curitÃ©...", type: "info", delay: 80 },
                    { text: ">>> VÃ©rification des protocoles de communication...", type: "success", delay: 120 },
                    { text: ">>> Ã‰tablissement d'une connexion chiffrÃ©e (AES-256)...", type: "info", delay: 100 },
                    { text: ">>> Validation des certificats de sÃ©curitÃ©...", type: "success", delay: 110 },
                    { text: ">>> Routage via des nÅ“uds anonymes...", type: "info", delay: 130 },
                    { text: "ALERTE: Tentative d'analyse de port dÃ©tectÃ©e", type: "warning", delay: 200 },
                    { text: ">>> Activation des contre-mesures dÃ©fensives...", type: "info", delay: 90 },
                    { text: ">>> DÃ©ploiement du pare-feu dynamique...", type: "success", delay: 120 },
                    { text: "ERREUR: Tentative d'injection de code bloquÃ©e", type: "error", delay: 180 },
                    { text: ">>> RÃ©initialisation des identifiants de session...", type: "info", delay: 100 },
                    { text: ">>> Obfuscation de l'empreinte numÃ©rique...", type: "success", delay: 90 },
                    { text: ">>> VÃ©rification de l'intÃ©gritÃ© du systÃ¨me...", type: "info", delay: 120 },
                    { text: ">>> GÃ©nÃ©ration de clÃ©s Ã©phÃ©mÃ¨res...", type: "success", delay: 110 },
                    { text: ">>> Ã‰tablissement du tunnel sÃ©curisÃ©...", type: "info", delay: 130 },
                    { text: "AVERTISSEMENT: Authentification multi-facteurs requise", type: "warning", delay: 250 },
                    { text: ">>> VÃ©rification des identifiants biomÃ©triques...", type: "info", delay: 300 },
                    { text: ">>> AccÃ¨s accordÃ© - Bienvenue sur le portail", type: "success", delay: 120 },
                    { text: ">>> Chargement de l'interface EL CARTEL...", type: "success", delay: 100 }
                ];

                this.currentCommand = 0;
                this.isTyping = false;
            }

            init() {
                this.createMatrixEffect();
                setTimeout(() => {
                    this.startSecuritySequence();
                }, 500);
            }

            createMatrixEffect() {
                const matrixBg = document.getElementById('matrixBg');
                const chars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&*()_+-=[]{}|;:,.<>?';
                for (let i = 0; i < 50; i++) {
                    const char = document.createElement('div');
                    char.className = 'matrix-char';
                    char.textContent = chars[Math.floor(Math.random() * chars.length)];
                    char.style.left = Math.random() * 100 + '%';
                    char.style.animationDelay = Math.random() * 2 + 's';
                    char.style.animationDuration = (Math.random() * 2 + 1) + 's';
                    matrixBg.appendChild(char);
                }
            }

            async startSecuritySequence() {
                for (const command of this.commands) {
                    await this.typeCommand(command);
                    await this.sleep(command.delay);
                }
                await this.showProgressBar();
                await this.sleep(1000);
                this.completeAccess();
            }

            async typeCommand(command) {
                return new Promise((resolve) => {
                    const line = document.createElement('div');
                    line.className = `terminal-line ${command.type}`;
                    if (command.type === 'error' || command.type === 'warning') {
                        const glitchSpan = document.createElement('span');
                        glitchSpan.className = 'glitch';
                        glitchSpan.setAttribute('data-text', command.text);
                        glitchSpan.textContent = command.text;
                        line.appendChild(glitchSpan);
                    } else {
                        line.textContent = command.text;
                    }
                    this.terminalOutput.appendChild(line);
                    if (this.terminalOutput.scrollHeight > this.terminalOutput.clientHeight) {
                        this.terminalOutput.scrollTop = this.terminalOutput.scrollHeight;
                    }

                    setTimeout(resolve, 30);
                });
            }

            async showProgressBar() {
                this.progressBar.style.display = 'block';
                const line = document.createElement('div');
                line.className = 'terminal-line success';
                line.innerHTML = '>>> Finalisation de la connexion sÃ©curisÃ©e... <span class="cursor"></span>';
                this.terminalOutput.appendChild(line);
                this.terminalOutput.scrollTop = this.terminalOutput.scrollHeight;

                return new Promise((resolve) => {
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += Math.random() * 10 + 5;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            this.progressFill.style.width = '100%';
                            setTimeout(resolve, 300);
                        } else {
                            this.progressFill.style.width = progress + '%';
                        }
                    }, 100);
                });
            }

            completeAccess() {
                const finalLine = document.createElement('div');
                finalLine.className = 'terminal-line success';
                finalLine.innerHTML = '<strong>âœ“ ACCÃˆS SÃ‰CURISÃ‰ Ã‰TABLI - REDIRECTION EN COURS...</strong>';
                this.terminalOutput.appendChild(finalLine);
                requestAnimationFrame(() => {
                    this.terminalOutput.scrollTop = this.terminalOutput.scrollHeight;
                });

                setTimeout(() => {
                    this.securityOverlay.classList.add('hidden');
                    setTimeout(() => {
                        this.mainContent.classList.add('visible');
                        document.body.style.overflow = 'auto';
                    }, 1000);
                }, 1500);
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            const animation = new SecurityAnimation();
            animation.init();
        });
        function createSecurityParticles() {
            const particles = [];
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = '1px';
                particle.style.height = '1px';
                particle.style.background = '#00ff00';
                particle.style.borderRadius = '50%';
                particle.style.opacity = Math.random() * 0.5;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animation = `float ${Math.random() * 3 + 2}s linear infinite`;
                document.querySelector('.matrix-bg').appendChild(particle);
            }
        }
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0% { transform: translateY(0px) rotate(0deg); }
                50% { transform: translateY(-10px) rotate(180deg); } /* Mouvement rÃ©duit */
                100% { transform: translateY(0px) rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
        let currentUserRole = 'guest'; // 'guest', 'user', 'admin'
        const GANGS_DATA_PATH = '/.netlify/functions/gangs-data';
        const darkwebAccess = [
            {
                credentials: {
                    name: "US1D7045GC041C",
                    message: "1750"
                },
                role: "user",
                redirectPage: "darkweb.html",
                webhookMessage: "âš¡ AccÃ¨s dÃ©tectÃ© pour un membre des DGC"
            },
            {
                credentials: {
                    name: "Admin",
                    message: "code"
                },
                role: "admin",
                redirectPage: "darkweb.html",
                webhookMessage: "âš ï¸ AccÃ¨s admin dÃ©tectÃ©"
            },
            {
                credentials: {
                    name: "CartelMember",
                    message: "cartelpass"
                },
                role: "cartel",
                redirectPage: "darkweb.html",
                webhookMessage: "ðŸ‘‘ AccÃ¨s membre du Cartel dÃ©tectÃ©"
            }
        ];
        const products = [
            {
                id: 'prod001',
                name: 'Chargeur de 15 Balles de pistolet',
                category: 'Minutions',
                price: 20000,
                description: 'Chargeur de pistolet Ã  usage unique. Garanti de sÃ©curitÃ© maximale et rÃ©sistance Ã  toutes les conditions.',
                image: 'https://media.discordapp.net/attachments/1232583375181582366/1387087700313505852/3fcf2fe3-dd13-4798-9041-e8af8b338b51.png?ex=685c1196&is=685ac016&hm=0b98e6a808a15974a5bf2b1dd9d6467734bb0c31341970e093e34bee56b17fbb&=&format=webp&quality=lossless&width=930&height=930' // Example image
            },
            {
                id: 'prod002',
                name: 'Chargeur de 36 Balles de smg',
                category: 'Minutions',
                price: 60000,
                description: 'Chargeur de SMG Ã  usage unique. OptimisÃ© pour une efficacitÃ© sans pareille dans les situations critiques.',
                image: 'https://media.discordapp.net/attachments/1232583375181582366/1387087700313505852/3fcf2fe3-dd13-4798-9041-e8af8b338b51.png?ex=685c1196&is=685ac016&hm=0b98e6a808a15974a5bf2b1dd9d6467734bb0c31341970e093e34bee56b17fbb&=&format=webp&quality=lossless&width=930&height=930' // Example image
            },
            {
                id: 'prod003',
                name: 'Chargeur de 12 Balles de pompe',
                category: 'Minutions',
                price: 100000,
                description: 'Chargeur de pompe Ã  usage unique. ConÃ§u pour des opÃ©rations spÃ©ciales nÃ©cessitant une prÃ©cision accrue.',
                image: 'https://media.discordapp.net/attachments/1232583375181582366/1387087700313505852/3fcf2fe3-dd13-4798-9041-e8af8b338b51.png?ex=685c1196&is=685ac016&hm=0b98e6a808a15974a5bf2b1dd9d6467734bb0c31341970e093e34bee56b17fbb&=&format=webp&quality=lossless&width=930&height=930' // Example image
            },
            {
                id: 'prod004',
                name: 'Chargeur de 60 balles de fusil d\'assaut',
                category: 'Minutions',
                price: 100000,
                description: 'Chargeur de fusil d\'assaut Ã  usage unique. OptimisÃ© pour des opÃ©rations critiques et des situations critiques.',
                image: 'https://media.discordapp.net/attachments/1232583375181582366/1387087700313505852/3fcf2fe3-dd13-4798-9041-e8af8b338b51.png?ex=685c1196&is=685ac016&hm=0b98e6a808a15974a5bf2b1dd9d6467734bb0c31341970e093e34bee56b17fbb&=&format=webp&quality=lossless&width=930&height=930' // Example image
            },
            {
                id: 'prod005',
                name: 'Chargeur amÃ©liorÃ© armes lÃ©gÃ¨res',
                category: 'Munitions',
                price: 200000,
                description: 'Chargeur permettant de stocker plus de munitions sur une arme de poing.',
                image: 'https://media.discordapp.net/attachments/1232583375181582366/1387087700313505852/3fcf2fe3-dd13-4798-9041-e8af8b338b51.png?ex=685c1196&is=685ac016&hm=0b98e6a808a15974a5bf2b1dd9d6467734bb0c31341970e093e34bee56b17fbb&=&format=webp&quality=lossless&width=930&height=930' // Example image
            },
            {
                id: 'prod006',
                name: 'Chargeur amÃ©liorÃ© armes lourdes',
                category: 'Munitions',
                price: 700000,
                description: 'Chargeur permettant de stocker plus de munitions sur une arme lourde.',
                image: 'https://media.discordapp.net/attachments/1232583375181582366/1387087700313505852/3fcf2fe3-dd13-4798-9041-e8af8b338b51.png?ex=685c1196&is=685ac016&hm=0b98e6a808a15974a5bf2b1dd9d6467734bb0c31341970e093e34bee56b17fbb&=&format=webp&quality=lossless&width=930&height=930' // Example image
            },
            {
                id: 'prod007',
                name: 'Silencieux sur arme de poing ',
                category: 'Accessoires',
                price: 160000,
                description: 'Silencieux sur arme de poing tel que des pistolets',
                image: 'https://media.discordapp.net/attachments/1232583375181582366/1387087700313505852/3fcf2fe3-dd13-4798-9041-e8af8b338b51.png?ex=685c1196&is=685ac016&hm=0b98e6a808a15974a5bf2b1dd9d6467734bb0c31341970e093e34bee56b17fbb&=&format=webp&quality=lossless&width=930&height=930' // Example image
            },
            {
                id: 'prod008',
                name: 'Silencieux armes lourdes',
                category: 'Accessoires',
                price: 300000,
                description: 'Silencieux sur arme lourdes tel que des fusil d\'assaut ou des fusil de sniper.',
                image: 'https://media.discordapp.net/attachments/1232583375181582366/1387087700313505852/3fcf2fe3-dd13-4798-9041-e8af8b338b51.png?ex=685c1196&is=685ac016&hm=0b98e6a808a15974a5bf2b1dd9d6467734bb0c31341970e093e34bee56b17fbb&=&format=webp&quality=lossless&width=930&height=930' // Example image
            },
        ];

        let cart = [];
        let currentUser = null;
        let currentProductInModal = null;

        document.getElementById('authForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = {
                name: document.getElementById('name').value.trim(),
                message: document.getElementById('message').value.trim()
            };
            document.getElementById('loading').classList.add('show');
            document.getElementById('errorMessage').classList.remove('show');
            setTimeout(() => {
                const accessGranted = validateAccess(formData);
                document.getElementById('loading').classList.remove('show');
                if (accessGranted) {
                    currentUser = accessGranted;
                    grantAccess(accessGranted);
                } else {
                    document.getElementById('errorMessage').classList.add('show');
                }
            }, 1500);
        });

        function redirectToHome(closeCurrentPage) {
            if (closeCurrentPage) {
                window.open('index.html', '_blank');
                try {
                    window.open('', '_self').close();
                } catch (e) {
                    window.location.href = 'index.html';
                }
            } else {
                window.location.href = 'index.html';
            }
        }

        function validateAccess(formData) {
            for (const access of darkwebAccess) {
                if (access.credentials.name === formData.name) {
                    const messageMatches = access.credentials.message === formData.message ||
                                           formData.message.toLowerCase().includes(access.credentials.message.toLowerCase());

                    if (messageMatches) {
                        return access;
                    }
                }
            }
            return null;
        }

        function grantAccess(accessConfig) {
            console.log(`Webhook envoyÃ©: ${accessConfig.webhookMessage}`);
            console.log(`Utilisateur: ${accessConfig.credentials.name}`);
            console.log(`Redirection vers: ${accessConfig.redirectPage}`);
            sendDiscordWebhook(`**AccÃ¨s au portail**\nUtilisateur: \`${accessConfig.credentials.name}\`\nMessage: \`${document.getElementById('message').value.trim()}\`\nStatut: AccÃ¨s accordÃ© (${accessConfig.webhookMessage})`, 0x228B22);
            currentUserRole = accessConfig.role;
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            setTimeout(() => {
                if (currentUserRole === 'admin') {
                    document.getElementById('gangsPage').classList.add('active');
                    document.getElementById('editGangsBtn').style.display = 'block';
                    loadGangsData();
                } else if (currentUserRole === 'user') {
                    document.getElementById('shopPage').classList.add('active');
                    renderProducts();
                } else if (currentUserRole === 'cartel') {
                    document.getElementById('gangsPage').classList.add('active');
                    document.getElementById('shopPage').classList.add('active');
                    document.getElementById('editGangsBtn').style.display = 'none';
                    loadGangsData();
                    renderProducts();
                }
            }, 300);
        }

        async function loadGangsData() {
            try {
                const response = await fetch(GANGS_DATA_PATH);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                displayGangsData(data);
                document.getElementById('editGangsData').value = JSON.stringify(data, null, 2); // Pour le modal d'Ã©dition
            } catch (error) {
                console.error("Erreur lors du chargement des donnÃ©es des gangs:", error);
                document.getElementById('gangsContent').innerHTML = '<p style="color: #ff3333;">Erreur lors du chargement des donnÃ©es. Veuillez rÃ©essayer plus tard.</p>';
            }
        }

        function displayGangsData(data) {
            const gangsContentDiv = document.getElementById('gangsContent');
            gangsContentDiv.innerHTML = ''; // Nettoyer le contenu prÃ©cÃ©dent

            if (data && data.gangs && Array.isArray(data.gangs)) {
                data.gangs.forEach(gang => {
                    const gangSection = document.createElement('div');
                    gangSection.innerHTML = `
                        <h4>${gang.name}</h4>
                        <p><strong>Description:</strong> ${gang.description}</p>
                        <p><strong>Territoire:</strong> ${gang.territory}</p>
                        <p><strong>ActivitÃ©s Principales:</strong> ${gang.activities.join(', ')}</p>
                        ${gang.members && gang.members.length > 0 ? `
                            <p><strong>Membres ClÃ©s:</strong></p>
                            <ul>
                                ${gang.members.map(member => `<li>${member.name} (${member.role})</li>`).join('')}
                            </ul>
                        ` : ''}
                        ${gang.notableEvents && gang.notableEvents.length > 0 ? `
                            <p><strong>Ã‰vÃ©nements Marquants:</strong></p>
                            <ul>
                                ${gang.notableEvents.map(event => `<li>${event.date}: ${event.description}</li>`).join('')}
                            </ul>
                        ` : ''}
                    `;
                    gangsContentDiv.appendChild(gangSection);
                });
            } else {
                gangsContentDiv.innerHTML = '<p style="color: #b0b0b0; text-align: center;">Aucune donnÃ©e de gang disponible.</p>';
            }
        }

        function openEditModal() {
            document.getElementById('editModal').classList.add('show');
            document.getElementById('editErrorMessage').classList.remove('show');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
        }

        async function saveGangsData() {
            const textarea = document.getElementById('editGangsData');
            const errorMessage = document.getElementById('editErrorMessage');
            errorMessage.classList.remove('show');

            try {
                const dataToSave = JSON.parse(textarea.value); // Tente de parser le JSON
                const adminCode = document.getElementById('message').value.trim(); // RÃ©cupÃ©rer le code d'accÃ¨s admin

                const response = await fetch(GANGS_DATA_PATH, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminCode}` // Envoyer le code d'accÃ¨s pour l'autorisation
                    },
                    body: JSON.stringify(dataToSave)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Erreur serveur: ${response.status} - ${errorText}`);
                }

                const result = await response.json();
                console.log("DonnÃ©es des gangs sauvegardÃ©es:", result);
                alert("DonnÃ©es sauvegardÃ©es avec succÃ¨s !");
                closeEditModal();
                loadGangsData();
            } catch (error) {
                console.error("Erreur lors de la sauvegarde des donnÃ©es des gangs:", error);
                errorMessage.textContent = `Erreur: ${error.message}. VÃ©rifiez le format JSON.`;
                errorMessage.classList.add('show');
            }
        }
        document.getElementById('editGangsBtn').addEventListener('click', openEditModal);
        function renderProducts() {
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = '';
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');
                productCard.setAttribute('data-product-id', product.id);
                productCard.onclick = () => openProductModal(product.id);
                productCard.innerHTML = `
                    <div class="product-header">
                        <div>
                            <h3 class="product-title">${product.name}</h3>
                            <p class="product-category">${product.category}</p>
                        </div>
                        <div class="product-price">$${product.price.toLocaleString()}</div>
                    </div>
                    <p class="product-description">${product.description}</p>
                    <div class="product-actions">
                        <button class="btn" onclick="event.stopPropagation(); addToCart('${product.id}')">PANIER ðŸ›’</button>
                        <button class="btn btn-danger" onclick="event.stopPropagation(); buyDirect('${product.id}')">ACHETER ðŸª™</button>
                    </div>
                `;
                productGrid.appendChild(productCard);
            });
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                cart.push({ ...product, cartId: Date.now() });
                updateCartDisplay();
                animateCartIcon();
            }
        }

        function updateCartDisplay() {
            const cartCount = document.getElementById('cartCount');
            const cartItemsContainer = document.getElementById('cartItems');
            cartCount.textContent = cart.length;
            cartItemsContainer.innerHTML = '';

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p style="color: #666;">Votre panier est vide.</p>';
            } else {
                const groupedItems = {};
                cart.forEach(item => {
                    if (groupedItems[item.id]) {
                        groupedItems[item.id].quantity += 1;
                        groupedItems[item.id].cartIds.push(item.cartId);
                    } else {
                        groupedItems[item.id] = {
                            ...item,
                            quantity: 1,
                            cartIds: [item.cartId]
                        };
                    }
                });
                Object.values(groupedItems).forEach(item => {
                    const totalPrice = item.price * item.quantity;
                    const itemHTML = `
                        <div class="cart-item">
                            <span class="cart-item-name">${item.name} ${item.quantity > 1 ? `x${item.quantity}` : ''}</span>
                            <span class="cart-item-price">$${totalPrice.toLocaleString()}</span>
                            <button class="cart-item-remove" onclick="removeFromCart('${item.id}')">ðŸ—‘ï¸</button>
                        </div>
                    `;
                    cartItemsContainer.innerHTML += itemHTML;
                });
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
        }

        function toggleCart() {
            const cartDropdown = document.getElementById('cartDropdown');
            cartDropdown.classList.toggle('open');
        }

        function animateCartIcon() {
            const cartIcon = document.querySelector('.cart-icon');
            cartIcon.classList.add('animated');
            setTimeout(() => {
                cartIcon.classList.remove('animated');
            }, 500);
        }

        function checkout() {
            if (cart.length === 0) {
                alert('Votre panier est vide !');
                return;
            }
            const orderDetails = cart.map(item => `${item.name} ($${item.price.toLocaleString()})`).join('\n');
            const totalAmount = cart.reduce((sum, item) => sum + item.price, 0);
            const orderRef = 'ORD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            sendDarkwebOrderWebhook({
                type: 'checkout',
                orderRef: orderRef,
                userName: currentUser ? currentUser.credentials.name : 'Inconnu',
                orderDetails: orderDetails,
                totalAmount: totalAmount,
                items: cart
            });
            showNotification(orderRef);
            cart = [];
            updateCartDisplay();
        }

        function buyDirect(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const orderRef = 'ORD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                sendDarkwebOrderWebhook({
                    type: 'direct_buy',
                    orderRef: orderRef,
                    userName: currentUser ? currentUser.credentials.name : 'Inconnu',
                    product: product,
                    totalAmount: product.price
                });
                showNotification(orderRef);
                closeModal();
            }
        }

        async function sendDarkwebOrderWebhook(orderData) {
            try {
                const response = await fetch('/.netlify/functions/send-darkweb-order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Erreur lors de l\'envoi de la commande darkweb:', errorData.error);
                } else {
                    console.log('Commande darkweb envoyÃ©e avec succÃ¨s via Netlify Function');
                }
            } catch (error) {
                console.error('Erreur rÃ©seau lors de l\'envoi de la commande darkweb:', error);
            }
        }
        async function sendDiscordWebhook(message, color) {
            try {
                const response = await fetch('/.netlify/functions/send-darkweb', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: 'general_alert',
                        message: message,
                        color: color,
                        timestamp: new Date().toISOString()
                    })
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('Erreur lors de l\'envoi du webhook Discord:', errorData.error);
                } else {
                    console.log('Webhook Discord envoyÃ© avec succÃ¨s.');
                }
            } catch (error) {
                console.error('Erreur rÃ©seau lors de l\'envoi du webhook Discord:', error);
            }
        }

        function openProductModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            currentProductInModal = product;

            document.getElementById('modalImage').src = product.image;
            document.getElementById('modalTitle').textContent = product.name;
            document.getElementById('modalCategory').textContent = product.category;
            document.getElementById('modalPrice').textContent = `$${product.price.toLocaleString()}`;
            document.getElementById('modalDescription').textContent = product.description;

            document.getElementById('modalAddToCartBtn').onclick = () => {
                addToCart(currentProductInModal.id);
                closeModal();
            };
            document.getElementById('modalBuyDirectBtn').onclick = () => {
                buyDirect(currentProductInModal.id);
            };

            document.getElementById('productModal').classList.add('show');
        }

        function closeModal() {
            const modal = document.getElementById('productModal');
            modal.classList.remove('show');
            currentProductInModal = null;
        }

        window.onclick = function(event) {
            const productModal = document.getElementById('productModal');
            const editModal = document.getElementById('editModal');
            if (event.target == productModal) {
                closeModal();
            }
            if (event.target == editModal) {
                closeEditModal();
            }
        }

        function showNotification(orderRef) {
            const notification = document.getElementById('notification');
            document.getElementById('orderRef').textContent = orderRef;
            notification.classList.add('show');
        }

        function closeNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('show');
        }
    </script>
</body>
</html>
